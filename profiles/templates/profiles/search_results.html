{% extends 'profiles/base.html' %}
{% load static %} {# <-- Ensure static is loaded for the default image #}
{% load widget_tweaks %}

{% block title %}Search Users | LinkUp{% endblock %}

{% block content %}
<div class="container mt-5">
    <h3 class="mb-4 text-primary"><i class="fas fa-search"></i> Search Users</h3>

    <form method="GET" class="mb-4">
        <div class="input-group input-group-lg shadow-sm">
            {# Placeholder added as requested #}
            {{ form.query|add_class:"form-control border-primary"|attr:"placeholder:Search by username, job title, or location..." }} 
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
    </form>

    {% if results %}
        {# Display results when they are present #}
        <p class="text-muted">Found <span class="fw-bold">{{ results|length }}</span> result{{ results|length|pluralize }}:</p>
        <ul class="list-group">
            {% for profile in results %}
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                    <div class="d-flex align-items-center">
                        
                        {# Profile Image Handling: Use the proper fallback logic #}
                        <img src="{% if profile.image %}{{ profile.image.url }}{% else %}{% static 'profiles/images/default.jpg' %}{% endif %}"
                             class="rounded-circle me-3 border" 
                             style="width: 45px; height: 45px; object-fit: cover;" 
                             alt="{{ profile.user.username }}'s avatar">
                        
                        <div>
                            <a href="{% url 'profiles:profile_detail' profile.user.username %}" class="text-dark text-decoration-none">
                                <strong class="d-block">{{ profile.user.username }}</strong>
                            </a>
                            <small class="text-secondary d-block">{{ profile.job_title|default:"No Job Title" }}</small>
                        </div>
                    </div>
                    <a href="{% url 'profiles:profile_detail' profile.user.username %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye me-1"></i> View Profile
                    </a>
                </li>
            {% endfor %}
        </ul>

    {% elif form.query.value %}
        {# Show this only if a search was performed (query is not empty) #}
        <div class="alert alert-warning text-center mt-5">
            <i class="fas fa-exclamation-triangle"></i> Sorry, no users matched your query. Try a different term.
        </div>
    
    {% else %}
        {# Show this default message before the first search #}
        <div class="alert alert-info text-center mt-5">
            <i class="fas fa-lightbulb"></i> Enter a term above to find users on LinkUp!
        </div>
    {% endif %}
</div>
{% endblock %}